#!/usr/bin/env ruby
if ARGV.size == 0 or (ARGV[0] != "diff" and ARGV[0] != "sync" and ARGV[0] != "help")
  puts "Usage: iam-manager [diff|help|sync]"
  exit
end

if ARGV[0] == "help"
  puts "iam-manager: Run the IAM Manager application."
  puts "\tCompiles IAM roles and policies that are defined with configuration files (see policies/static, policies/template and roles/) and syncs the resulting IAM roles with AWS."
  puts
  puts "Commands"
  puts "\tdiff\t- get a list of roles that have different definitions locally than in AWS"
  puts "\tsync\t- sync the local role definition with AWS"
  exit
end

# set up the application path
$LOAD_PATH.unshift(File.expand_path(
  File.join(File.dirname(__FILE__), "../lib")
))

# set up configuration for the application
require "conf/Configuration"
project_root = File.expand_path(
  File.join(File.dirname(__FILE__), "../")
)
Configuration.init(project_root, "conf/configuration.json")

# run the application with the desired command
require "Iam"
iam = Iam.new
if ARGV[0] == "diff"
  iam.diff
elsif ARGV[0] == "sync"
  iam.sync
end
